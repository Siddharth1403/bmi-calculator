<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D BMI Visualizer with Advanced Features</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .bmi-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        input[type="range"] {
            width: 100%;
            height: 10px;
            -webkit-appearance: none;
            background: #e0e0e0;
            border-radius: 5px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #4a90e2;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .visualization {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .human-shape {
            width: 120px;
            height: 200px;
            background: #4a90e2;
            border-radius: 60px 60px 20px 20px;
            position: relative;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .human-shape::before {
            content: '';
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }

        .human-shape::after {
            content: '';
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 20px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .human-shape:hover {
            animation: pulse 2s infinite;
        }

        .bmi-scale {
            width: 30px;
            height: 200px;
            background: linear-gradient(to top, #4CAF50, #FFC107, #FF5722);
            border-radius: 15px;
            position: relative;
        }

        .scale-marker {
            width: 40px;
            height: 6px;
            background: #333;
            position: absolute;
            left: -5px;
            transform: translateY(-50%);
            transition: top 0.5s ease-out;
        }

        .scale-labels {
            position: absolute;
            right: -60px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 12px;
            font-weight: bold;
        }

        .results {
            margin-bottom: 20px;
        }

        .bmi-value {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
            transition: color 0.3s;
        }

        .bmi-category {
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: bold;
            transition: color 0.3s;
        }

        .recommendations {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-top: 15px;
        }

        .recommendations ul {
            text-align: left;
            padding-left: 20px;
        }

        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            background: #357abd;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        .history {
            border-top: 1px solid #eee;
            padding-top: 20px;
            max-height: 150px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .history-item:hover {
            background: #f8f8f8;
        }

        .history-date {
            color: #777;
            min-width: 80px;
        }

        .history-values {
            margin: 0 10px;
        }

        .history-bmi {
            font-weight: bold;
            min-width: 100px;
            text-align: right;
        }

        .clear-history {
            background: #f44336;
            margin-top: 10px;
            padding: 8px 15px;
            font-size: 14px;
        }

        .clear-history:hover {
            background: #d32f2f;
        }

        .fitness-api-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 10px;
            display: none;
        }

        .goals-section {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .goal-progress {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .goal-progress-bar {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.5s;
        }

        @media (max-width: 600px) {
            .visualization {
                flex-direction: column;
            }
            
            .human-shape {
                margin-bottom: 20px;
            }
            
            .bmi-container {
                padding: 20px;
            }
            
            .history-item {
                flex-direction: column;
            }
            
            .history-date, .history-values, .history-bmi {
                margin: 3px 0;
                text-align: left;
                min-width: auto;
            }
        }

        /* Animation for new history items */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .history-item.new-item {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="bmi-container">
        <h1>3D BMI Visualizer</h1>
        
        <div class="input-section">
            <div class="input-group">
                <label for="height">Height (cm)</label>
                <input type="range" id="height" min="100" max="250" value="170" aria-label="Height in centimeters">
                <span id="height-value">170 cm</span>
            </div>
            
            <div class="input-group">
                <label for="weight">Weight (kg)</label>
                <input type="range" id="weight" min="30" max="200" value="70" aria-label="Weight in kilograms">
                <span id="weight-value">70 kg</span>
            </div>
        </div>
        
        <div class="visualization">
            <div class="human-shape" id="human-shape"></div>
            <div class="bmi-scale">
                <div class="scale-marker" id="scale-marker"></div>
                <div class="scale-labels">
                    <span>Underweight</span>
                    <span>Normal</span>
                    <span>Overweight</span>
                    <span>Obese</span>
                </div>
            </div>
        </div>
        
        <div class="results">
            <div class="bmi-value" id="bmi-value">--</div>
            <div class="bmi-category" id="bmi-category">Enter your details</div>
            <div class="recommendations" id="recommendations"></div>
        </div>
        
        <button id="save-btn">Save to History</button>
        
        <div class="goals-section" id="goals-section">
            <h3>Weight Goal Tracker</h3>
            <div>
                <label for="goal-weight">Target Weight (kg):</label>
                <input type="number" id="goal-weight" min="30" max="200" value="65">
            </div>
            <div class="goal-progress">
                <div class="goal-progress-bar" id="goal-progress"></div>
            </div>
            <div id="goal-status">Set a goal to track progress</div>
        </div>
        
        <div class="fitness-api-section" id="fitness-api-section">
            <h3>Fitness Integration</h3>
            <p>Connect with fitness apps for more accurate tracking:</p>
            <button id="connect-google-fit">Connect Google Fit</button>
            <button id="connect-apple-health">Connect Apple Health</button>
        </div>
        
        <div class="history" id="history">
            <h3>Your BMI History</h3>
        </div>
        <button class="clear-history" id="clear-history">Clear History</button>
    </div>
    
    <script>
        // DOM Elements
        const heightSlider = document.getElementById('height');
        const weightSlider = document.getElementById('weight');
        const heightValue = document.getElementById('height-value');
        const weightValue = document.getElementById('weight-value');
        const bmiValue = document.getElementById('bmi-value');
        const bmiCategory = document.getElementById('bmi-category');
        const recommendations = document.getElementById('recommendations');
        const humanShape = document.getElementById('human-shape');
        const scaleMarker = document.getElementById('scale-marker');
        const saveBtn = document.getElementById('save-btn');
        const historyContainer = document.getElementById('history');
        const clearHistoryBtn = document.getElementById('clear-history');
        const goalWeightInput = document.getElementById('goal-weight');
        const goalProgress = document.getElementById('goal-progress');
        const goalStatus = document.getElementById('goal-status');
        const fitnessApiSection = document.getElementById('fitness-api-section');
        const connectGoogleFitBtn = document.getElementById('connect-google-fit');
        const connectAppleHealthBtn = document.getElementById('connect-apple-health');

        // Update displayed values when sliders change
        heightSlider.addEventListener('input', updateBMI);
        weightSlider.addEventListener('input', updateBMI);
        goalWeightInput.addEventListener('input', updateGoalProgress);

        // Button click handlers
        saveBtn.addEventListener('click', saveToHistory);
        clearHistoryBtn.addEventListener('click', clearHistory);
        connectGoogleFitBtn.addEventListener('click', connectGoogleFit);
        connectAppleHealthBtn.addEventListener('click', connectAppleHealth);

        // Check if fitness API section should be shown (mobile devices)
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            fitnessApiSection.style.display = 'block';
        }

        // Initialize
        updateBMI();
        loadHistory();
        updateGoalProgress();

        function updateBMI() {
            // Get values
            const height = parseInt(heightSlider.value);
            const weight = parseInt(weightSlider.value);
            
            // Update displayed values
            heightValue.textContent = `${height} cm`;
            weightValue.textContent = `${weight} kg`;
            
            // Calculate BMI (weight in kg / (height in m)^2)
            const heightInMeters = height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);
            const roundedBMI = bmi.toFixed(1);
            
            // Update BMI display
            bmiValue.textContent = roundedBMI;
            
            // Determine category and color
            let category, color, recommendation;
            
            if (bmi < 18.5) {
                category = "Underweight";
                color = "#FFC107"; // Yellow
                recommendation = `
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Consult a nutritionist for healthy weight gain</li>
                        <li>Focus on nutrient-rich foods</li>
                        <li>Consider strength training to build muscle</li>
                    </ul>
                `;
            } else if (bmi >= 18.5 && bmi < 25) {
                category = "Normal weight";
                color = "#4CAF50"; // Green
                recommendation = `
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Maintain your healthy lifestyle</li>
                        <li>Continue balanced diet and regular exercise</li>
                        <li>Monitor your weight periodically</li>
                    </ul>
                `;
            } else if (bmi >= 25 && bmi < 30) {
                category = "Overweight";
                color = "#FF9800"; // Orange
                recommendation = `
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Increase physical activity gradually</li>
                        <li>Reduce calorie intake slightly</li>
                        <li>Focus on whole foods and portion control</li>
                    </ul>
                `;
            } else {
                category = "Obese";
                color = "#FF5722"; // Red
                recommendation = `
                    <h4>Recommendations:</h4>
                    <ul>
                        <li>Consult with a healthcare provider</li>
                        <li>Develop a safe weight management plan</li>
                        <li>Consider professional guidance for exercise</li>
                    </ul>
                `;
            }
            
            // Update category and recommendations
            bmiCategory.textContent = category;
            bmiCategory.style.color = color;
            bmiValue.style.color = color;
            recommendations.innerHTML = recommendation;
            
            // Update human shape visualization
            updateHumanShape(bmi);
            
            // Update scale marker position (BMI scale roughly 15-40)
            const markerPosition = Math.min(Math.max((bmi - 15) / 25 * 200, 0), 200);
            scaleMarker.style.top = `${200 - markerPosition}px`;
            
            // Update goal progress
            updateGoalProgress();
        }

        function updateHumanShape(bmi) {
            // Adjust the human shape based on BMI
            let width = 120;
            let height = 200;
            
            if (bmi < 18.5) {
                // Underweight - thinner
                width = 80 + (bmi - 15) * 10;
            } else if (bmi >= 18.5 && bmi < 25) {
                // Normal - proportional
                width = 100 + (bmi - 18.5) * 3;
            } else if (bmi >= 25 && bmi < 30) {
                // Overweight - wider
                width = 120 + (bmi - 25) * 8;
            } else {
                // Obese - much wider
                width = 160 + (bmi - 30) * 5;
            }
            
            // Apply the new width with smooth transition
            humanShape.style.width = `${width}px`;
            
            // Adjust border radius for more natural shape
            const borderRadius = Math.min(60, width/2);
            humanShape.style.borderRadius = `${borderRadius}px ${borderRadius}px 20px 20px`;
        }

        function saveToHistory() {
            const height = heightSlider.value;
            const weight = weightSlider.value;
            const bmi = bmiValue.textContent;
            const category = bmiCategory.textContent;
            const color = bmiCategory.style.color;
            
            // Create history item
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item new-item';
            
            // Get current date and time
            const now = new Date();
            const dateStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            historyItem.innerHTML = `
                <div class="history-date">${dateStr}</div>
                <div class="history-values">H: ${height}cm, W: ${weight}kg</div>
                <div class="history-bmi" style="color: ${color}">${bmi} (${category})</div>
            `;
            
            // Add to top of history
            historyContainer.appendChild(historyItem);
            
            // Remove new-item class after animation completes
            setTimeout(() => {
                historyItem.classList.remove('new-item');
            }, 500);
            
            // Show confirmation (temporary)
            const originalText = saveBtn.textContent;
            saveBtn.textContent = "âœ“ Saved!";
            setTimeout(() => {
                saveBtn.textContent = originalText;
            }, 2000);
            
            // Store in localStorage
            const historyData = {
                date: dateStr,
                height: height,
                weight: weight,
                bmi: bmi,
                category: category,
                color: color
            };
            
            let history = JSON.parse(localStorage.getItem('bmiHistory') || '[]');
            history.push(historyData); // Add to end
            localStorage.setItem('bmiHistory', JSON.stringify(history));
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('bmiHistory') || '[]');
            
            if (history.length === 0) {
                historyContainer.innerHTML = '<h3>Your BMI History</h3><p>No history yet. Save your first measurement!</p>';
                return;
            }
            
            historyContainer.innerHTML = '<h3>Your BMI History</h3>';
            
            history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-date">${item.date}</div>
                    <div class="history-values">H: ${item.height}cm, W: ${item.weight}kg</div>
                    <div class="history-bmi" style="color: ${item.color}">${item.bmi} (${item.category})</div>
                `;
                historyContainer.appendChild(historyItem);
            });
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all your BMI history?')) {
                localStorage.removeItem('bmiHistory');
                historyContainer.innerHTML = '<h3>Your BMI History</h3><p>No history yet. Save your first measurement!</p>';
            }
        }

        function updateGoalProgress() {
            const currentWeight = parseInt(weightSlider.value);
            const goalWeight = parseInt(goalWeightInput.value);
            
            if (isNaN(goalWeight) || goalWeight <= 0) {
                goalStatus.textContent = "Set a valid goal weight to track progress";
                goalProgress.style.width = "0%";
                return;
            }
            
            // Determine if goal is to lose or gain weight
            const weightDifference = Math.abs(currentWeight - goalWeight);
            let progress, statusText;
            
            if (currentWeight > goalWeight) {
                // Goal is weight loss
                const maxWeight = currentWeight;
                progress = ((maxWeight - currentWeight + weightDifference) / (maxWeight - goalWeight + weightDifference)) * 100;
                statusText = `Lose ${weightDifference}kg to reach your goal`;
            } else if (currentWeight < goalWeight) {
                // Goal is weight gain
                const minWeight = currentWeight;
                progress = ((currentWeight - minWeight) / (goalWeight - minWeight)) * 100;
                statusText = `Gain ${weightDifference}kg to reach your goal`;
            } else {
                // Goal reached
                progress = 100;
                statusText = "Goal achieved! ðŸŽ‰";
            }
            
            // Update progress bar and status
            goalProgress.style.width = `${Math.min(100, Math.max(0, progress))}%`;
            goalStatus.textContent = statusText;
            
            // Save goal to localStorage
            localStorage.setItem('bmiGoalWeight', goalWeight);
        }

        function connectGoogleFit() {
            alert("Google Fit integration would be implemented here in a real app. This is a demo.");
            // In a real app, this would open OAuth flow to connect to Google Fit API
        }

        function connectAppleHealth() {
            alert("Apple Health integration would be implemented here in a real app. This is a demo.");
            // In a real app, this would request HealthKit permissions
        }

        // Load saved goal weight
        const savedGoalWeight = localStorage.getItem('bmiGoalWeight');
        if (savedGoalWeight) {
            goalWeightInput.value = savedGoalWeight;
        }
    </script>
</body>
</html>